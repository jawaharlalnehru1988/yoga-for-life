<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="goBack()" defaultHref="/meditation"></ion-back-button>
    </ion-buttons>
    <ion-title>Meditation Details</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="shareMeditation()" *ngIf="session">
        <ion-icon name="share-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading meditation...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && session" class="meditation-detail">
    <!-- Hero Section -->
    <div class="hero-section">
      <div class="meditation-image">
        <img [src]="session.imageUrl" [alt]="session.title" />
        <div class="overlay-badges">
          <ion-badge *ngIf="session.isPremium" color="warning">
            <ion-icon name="diamond-outline"></ion-icon>
            Premium
          </ion-badge>
          <ion-badge *ngIf="session.isPopular" color="success">
            Popular
          </ion-badge>
          <ion-badge [color]="getDifficultyColor(session.difficulty)">
            {{ session.difficulty }}
          </ion-badge>
        </div>
      </div>

      <div class="meditation-header">
        <h1>{{ session.title }}</h1>
        <p class="instructor">with {{ session.instructor }}</p>
        
        <div class="session-meta">
          <div class="meta-item">
            <ion-icon name="time-outline"></ion-icon>
            <span>{{ session.duration }} min</span>
          </div>
          <div class="meta-item">
            <ion-icon [name]="getTechniqueIcon(session.technique)"></ion-icon>
            <span>{{ session.technique }}</span>
          </div>
          <div class="meta-item">
            <ion-icon name="star" color="warning"></ion-icon>
            <span>{{ session.rating }}/5</span>
          </div>
        </div>

        <div class="action-buttons">
          <ion-button expand="block" color="primary" (click)="playMeditation()">
            <ion-icon name="play" slot="start"></ion-icon>
            Play Meditation
          </ion-button>
          
          <div class="secondary-actions">
            <ion-button fill="outline" (click)="toggleFavorite()">
              <ion-icon 
                [name]="isFavorite ? 'heart' : 'heart-outline'" 
                [color]="isFavorite ? 'danger' : 'medium'">
              </ion-icon>
              {{ isFavorite ? 'Favorited' : 'Add to Favorites' }}
            </ion-button>
            
            <ion-button fill="outline" (click)="downloadForOffline()">
              <ion-icon name="download-outline"></ion-icon>
              Download
            </ion-button>
          </div>
        </div>
      </div>
    </div>

    <!-- Description Section -->
    <div class="content-section">
      <h2>About This Meditation</h2>
      <p class="description">{{ session.fullDescription }}</p>
      
      <div class="benefits-section" *ngIf="session.benefits.length > 0">
        <h3>Benefits</h3>
        <div class="benefits-grid">
          <div class="benefit-item" *ngFor="let benefit of session.benefits">
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
            <span>{{ benefit }}</span>
          </div>
        </div>
      </div>

      <div class="tags-section" *ngIf="session.tags.length > 0">
        <h3>Tags</h3>
        <div class="tags-container">
          <ion-chip *ngFor="let tag of session.tags" color="light">
            <ion-label>{{ tag }}</ion-label>
          </ion-chip>
        </div>
      </div>

      <div class="instructions-section" *ngIf="session.instructions.length > 0">
        <h3>Instructions</h3>
        <div class="instructions-list">
          <div class="instruction-item" *ngFor="let instruction of session.instructions; let i = index">
            <span class="step-number">{{ i + 1 }}</span>
            <span class="instruction-text">{{ instruction }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Instructor Section -->
    <div class="content-section" *ngIf="session.instructor">
      <h2>Instructor</h2>
      <p><strong>{{ session.instructor }}</strong> guides you through this meditation experience.</p>
    </div>

    <!-- Related Meditations -->
    <div class="content-section" *ngIf="relatedSessions.length > 0">
      <h2>More Like This</h2>
      <div class="related-sessions">
        <ion-card 
          *ngFor="let relatedSession of relatedSessions" 
          class="session-card"
          (click)="openRelatedSession(relatedSession)">
          
          <div class="card-image">
            <img [src]="relatedSession.imageUrl" [alt]="relatedSession.title" />
            <ion-button 
              fill="clear" 
              class="play-button"
              (click)="playMeditation(); $event.stopPropagation()">
              <ion-icon name="play" color="light"></ion-icon>
            </ion-button>
          </div>

          <ion-card-header>
            <ion-card-subtitle>{{ relatedSession.instructor }}</ion-card-subtitle>
            <ion-card-title>{{ relatedSession.title }}</ion-card-title>
          </ion-card-header>

          <ion-card-content>
            <div class="session-meta-small">
              <span class="duration">
                <ion-icon name="time-outline"></ion-icon>
                {{ relatedSession.duration }} min
              </span>
              <span class="rating">
                <ion-icon name="star" color="warning"></ion-icon>
                {{ relatedSession.rating }}
              </span>
            </div>
            <p>{{ relatedSession.shortDescription }}</p>
          </ion-card-content>
        </ion-card>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="!isLoading && !session">
    <ion-icon name="alert-circle-outline" color="medium"></ion-icon>
    <h2>Meditation Not Found</h2>
    <p>The meditation you're looking for couldn't be found.</p>
    <ion-button fill="outline" (click)="goBack()">
      <ion-icon name="arrow-back" slot="start"></ion-icon>
      Go Back
    </ion-button>
  </div>
</ion-content>
